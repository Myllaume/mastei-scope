---
pagination:
  data: records
  size: 1
  alias: record
permalink: "/records/{{ record.id }}/"
layout: base.liquid
eleventyComputed:
  title: "{{ record.title }}"
---

<article>
  <header>
    <h1>{{ record.title | frenchQuotes }}</h1>
    {% if record.alias.size > 0 %}
    <h2>{{ record.alias | join: " • " }}</h2>
    {% endif %}
    <samp>line {{ record.line }}</samp>
  </header>

  <section class="prose">
    {{ record.description | frenchQuotes | links_html: record | bibliographyIndex: record | br_to_paragraph }}
  </section>

  <footer>
    {% if record.backlinks.size > 0 %}
      <section>
        <details open>
          <summary>Rétroliens ({{ record.backlinks.size }})</summary>
          <ul>
            {% for link in record.backlinks %}
              <li>
                <a href="/records/{{ link.id }}/">{{ link.title | frenchQuotes }}</a>
                {% if link.context.size > 0 %}
                  {%- for context in link.context -%}
                    <p class="prose">{{ context | frenchQuotes | bibliographyIndex: link | highlightRecord : record }}</p>
                  {%- endfor -%}
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        </details>
      </section>
    {% endif %}

    <hr />
    
    {% if record.links.size > 0 %}
      <section>
        <details>
          <summary>Liens ({{ record.links.size }})</summary>
          <ul>
            {%- for link in record.links -%}
              <li><a href="/records/{{ link.id }}/">{{ link.title | frenchQuotes }}</a></li>
            {%- endfor -%}
          </ul>
        </details>
      </section>
    {% endif %}

    {% if record.communityRecords.size > 0 %}
      <section>
        <details>
          <summary>Communauté ({{ record.communityRecords.size }})</summary>
          <ul>
            {%- for r in record.communityRecords -%}
              <li><a href="/records/{{ r.id }}/">{{ r.title | frenchQuotes }}</a></li>
            {%- endfor -%}
          </ul>
        </details>
      </section>
    {% endif %}

    {% if record.deepLinks.size > 0 %}
    <section>
      <details>
        {% assign totalDeepLinks = 0 %}
        {% for depth in record.deepLinks %}
          {% assign totalDeepLinks = totalDeepLinks | plus: depth.size %}
        {% endfor %}

        <summary>Liens profonds ({{ totalDeepLinks }})</summary>
        <ol>
        {% for depth in record.deepLinks %}
          <li>
            <ul>
              {% for record in depth %}
              <li><a href="/records/{{ record.id }}/">{{ record.title | frenchQuotes }}</a></li>
              {% endfor %}
            </ul>
          </li>
          {% endfor %}
        </ol>
      </details>
    </section>
    {% endif %}

    <section>
      <details>
        <summary>Notes de bas de page</summary>
        {{ record.description | bibliographyFootnotes }}
      </details>
    </section>

    {% if record.tags.size > 0 %}
      <section>
        <details>
          <summary>Tags ({{ record.tags.size }})</summary>
          <ul>
            {%- for tag in record.tags -%}
              <li><a href="/tags/{{ tag }}">{{ tag }}</a></li>
            {%- endfor -%}
          </ul>
        </details>
      </section>
    {% endif %}

    {% if record.report.size > 0 %}
      <section>
        <details>
          <summary>Anomalies ({{ record.report.size }})</summary>
          <ul>
            {%- for anomaly in record.report -%}
              <li><samp>{{ anomaly }}</samp></li>
            {%- endfor -%}
          </ul>
        </details>
      </section>
    {% endif %}

    {% if record.bibliographicEntries.size > 0 %}
      <section>
        <details>
          <summary>Bibliographie ({{ record.bibliographicEntries.size }})</summary>
          <ul>
            {%- for entry in record.bibliographicEntries -%}
              <li>
                {{ entry.authors | join: ", " }}, {{ entry.year }}.
                <cite>{{ entry.title }}</cite>.
                {{ entry.place }}, {{ entry.publisher }}.
                ISBN : {{ entry.ISBN }}.
              </li>
            {%- endfor -%}
          </ul>
        </details>
      </section>
    {% endif %}
  </footer>

</article>
